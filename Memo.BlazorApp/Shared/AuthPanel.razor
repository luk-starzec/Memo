
<div class="auth-panel__wrapper">

    <Padlock Error="@padlockError" Opened="@padlockOpened" />

    <div class="@cssMessage">@message</div>

    <input type="password" class="auth-panel__pin" @bind="@pin" placeholder="PIN" />

    <div class="auth-panel__buttons-wrapper">

        @for (int i = 1; i < 10; i++)
        {
            int index = i;
            <button class="auth-panel__button" @onclick="()=>OnClickNumber(index)">@i</button>
        }

        <button class="auth-panel__button auth-panel__button--clear" @onclick="OnClickClear">
            <img src="/assets/x-icon.svg" />
        </button>

        <button class="auth-panel__button" @onclick="()=>OnClickNumber(0)">0</button>

        <button class="auth-panel__button auth-panel__button--ok" @onclick="OnClickOk">
            <img src="/assets/check-icon.svg" />
        </button>

    </div>

</div>

@code {
    [Parameter]
    public EnumAuthorizationState AuthorizationState { get; set; }
    [Parameter]
    public EventCallback<string> OnLogIn { get; set; }

    public string pin;

    string message => AuthorizationState switch
    {
        EnumAuthorizationState.Checking => "Checking...",
        EnumAuthorizationState.Denied => "Access denied",
        EnumAuthorizationState.Granted => "Access granted",
        _ => "Authorization required"
    };
    string cssMessage
        => $"auth-panel__message {(AuthorizationState == EnumAuthorizationState.Denied ? "auth-panel__message--error" : "")} {(AuthorizationState == EnumAuthorizationState.Granted ? "auth-panel__message--ok" : "")}";


    bool padlockError => AuthorizationState == EnumAuthorizationState.Denied;
    bool padlockOpened => AuthorizationState == EnumAuthorizationState.Granted;

    void OnClickNumber(int number) => pin += number.ToString();

    void OnClickClear() => pin = string.Empty;

    async Task OnClickOk() => await OnLogIn.InvokeAsync(pin);

}
