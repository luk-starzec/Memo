@page "/add"

@inject IMemosRepo memosRepo
@inject ITokenManager tokenManager;
@inject NavigationManager navigationManager

<div class="add-page__wrapper">

    <Logo class="add-page__logo" />

    <MemoAdd class="add-page__form" Memo="@memo" />

    <img class="add-page__background-image" src="/assets/add-image.svg" />

</div>

@code {
    MemoNewModel memo = new MemoNewModel();

    bool ValidateField(string field)
    {
        var errors = memo.Validate();
        return !errors.Where(r => r.MemberNames.Contains(field)).Any();
    }

    void GenerateUrl()
    {
        memo.Url = Helpers.GetUrl(memo.Title);
        StateHasChanged();
    }

    async Task AddMemo(EditContext editContext)
    {
        if (await memosRepo.CreateMemo(memo))
        {
            var token = tokenManager.CreateToken(memo.Pin);
            navigationManager.NavigateTo($"/view/{memo.Url}/{token}");
        }
        // TODO error handling
    }

}
